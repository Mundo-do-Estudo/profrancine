document.addEventListener("DOMContentLoaded",function(){let e=document.querySelectorAll(".nav-btn"),t=document.querySelectorAll(".screen"),a=document.querySelectorAll(".option"),n=document.getElementById("save-interview"),l=document.getElementById("clear-data"),i=document.getElementById("saved-data-body"),s=document.getElementById("download-chart"),r=document.getElementById("download-report"),o={reporter:"",interviewee:"",date:"",answers:{}},d=null;function c(){let e=JSON.parse(localStorage.getItem("bullyingInterviews"))||[];if(i.innerHTML="",0===e.length){i.innerHTML='<tr><td colspan="4" style="text-align: center; padding: 20px; color: #666;">Nenhuma entrevista salva ainda</td></tr>';return}e.forEach(e=>{let t=document.createElement("tr"),a=e.answers.q1||"N\xe3o respondido";t.innerHTML=`
                        <td style="padding: 12px; border-bottom: 1px solid #eee;">${e.reporter}</td>
                        <td style="padding: 12px; border-bottom: 1px solid #eee;">${e.interviewee}</td>
                        <td style="padding: 12px; border-bottom: 1px solid #eee;">${e.date}</td>
                        <td style="padding: 12px; border-bottom: 1px solid #eee;">${a}</td>
                    `,i.appendChild(t)})}function g(){let e=JSON.parse(localStorage.getItem("bullyingInterviews"))||[];if(document.getElementById("total-interviews").textContent=e.length,0===e.length){document.getElementById("bullying-victims").textContent="0%",document.getElementById("witnesses").textContent="0%",function e(){let t=document.getElementById("bullying-chart").getContext("2d");d&&d.destroy(),d=new Chart(t,{type:"doughnut",data:{labels:["Nenhuma entrevista realizada"],datasets:[{data:[1],backgroundColor:["#e0e0e0"],borderWidth:0},]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{font:{size:14},padding:20}},title:{display:!0,text:"Fa\xe7a algumas entrevistas para ver os resultados",font:{size:18}}}}})}();return}let t=0,a=0,n={ajudo:0,professor:0,nada:0},l={triste:0,"com-raiva":0,assustado:0,indiferente:0};e.forEach(e=>{"sim"===e.answers.q1&&t++,"sim"===e.answers.q2&&a++,e.answers.q3&&n.hasOwnProperty(e.answers.q3)&&n[e.answers.q3]++,e.answers.q4&&l.hasOwnProperty(e.answers.q4)&&l[e.answers.q4]++});let i=Math.round(t/e.length*100),s=Math.round(a/e.length*100);document.getElementById("bullying-victims").textContent=`${i}%`,document.getElementById("witnesses").textContent=`${s}%`,function e(t,a,n){let l=document.getElementById("bullying-chart").getContext("2d");d&&d.destroy(),d=new Chart(l,{type:"doughnut",data:{labels:["Sofreram Bullying","Apenas Presenciaram","N\xe3o Envolvidos"],datasets:[{data:[t,Math.max(0,a-t),n],backgroundColor:["#ff6b6b","#4facfe","#a1c4fd"],borderWidth:3,borderColor:"#ffffff"},]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{font:{size:14},padding:20,usePointStyle:!0}},title:{display:!0,text:"Resultados da Pesquisa sobre Bullying",font:{size:18,weight:"bold"},padding:20},tooltip:{callbacks:{label:function(e){let t=e.dataset.data.reduce((e,t)=>e+t,0),a=(e.parsed/t*100).toFixed(1);return`${e.label}: ${e.parsed} (${a}%)`}}}},animation:{animateRotate:!0,animateScale:!0,duration:1e3}}})}(t,a,e.length-a)}e.forEach(a=>{a.addEventListener("click",()=>{let n=a.getAttribute("data-screen");e.forEach(e=>e.classList.remove("active")),a.classList.add("active"),t.forEach(e=>e.classList.remove("active")),document.getElementById(`${n}-screen`).classList.add("active"),"results"===n&&setTimeout(()=>{g()},100),"data"===n&&c()})}),a.forEach(e=>{e.addEventListener("click",()=>{let t=e.closest(".question-container"),a=t.getAttribute("data-question");t.querySelectorAll(".option").forEach(e=>{e.classList.remove("selected")}),e.classList.add("selected"),o.answers[a]=e.getAttribute("data-value")})}),n.addEventListener("click",()=>{var e;o.reporter=document.getElementById("interviewer-name").value||"An\xf4nimo",o.interviewee=document.getElementById("interviewee-name").value||"An\xf4nimo",o.date=document.getElementById("interview-date").value||new Date().toISOString().split("T")[0];let t=document.querySelectorAll(".question-container").length,a=Object.keys(o.answers).length;if(a<t){alert("Por favor, responda todas as perguntas antes de salvar!");return}let n;e=o,(n=JSON.parse(localStorage.getItem("bullyingInterviews"))||[]).push(e),localStorage.setItem("bullyingInterviews",JSON.stringify(n)),document.getElementById("interviewer-name").value="",document.getElementById("interviewee-name").value="",document.getElementById("interview-date").value="",document.querySelectorAll(".option").forEach(e=>{e.classList.remove("selected")}),o={reporter:"",interviewee:"",date:"",answers:{}},alert("Entrevista salva com sucesso!")}),l.addEventListener("click",()=>{confirm("Tem certeza que deseja apagar todos os dados? Esta a\xe7\xe3o n\xe3o pode ser desfeita.")&&(localStorage.removeItem("bullyingInterviews"),c(),g(),alert("Todos os dados foram apagados!"))}),s.addEventListener("click",()=>{if(d){let e=document.getElementById("bullying-chart"),t=e.toDataURL("image/jpeg",.8),a=document.createElement("a");a.download=`pesquisa-bullying-${new Date().toISOString().split("T")[0]}.jpg`,a.href=t,a.click()}else alert("Nenhum gr\xe1fico dispon\xedvel para download. Fa\xe7a algumas entrevistas primeiro!")}),r.addEventListener("click",()=>{(function e(){var t;let a=JSON.parse(localStorage.getItem("bullyingInterviews"))||[];if(0===a.length){alert("Nenhuma entrevista dispon\xedvel para gerar relat\xf3rio!");return}let n=document.createElement("canvas");n.width=800,n.height=1200;let l=n.getContext("2d");l.fillStyle="#ffffff",l.fillRect(0,0,n.width,n.height),l.fillStyle="#4facfe",l.font="bold 32px Arial",l.textAlign="center",l.fillText("Relat\xf3rio da Pesquisa sobre Bullying",n.width/2,50),l.fillStyle="#666666",l.font="18px Arial",l.fillText(`Gerado em: ${new Date().toLocaleDateString("pt-BR")}`,n.width/2,80);let i=140;l.fillStyle="#333333",l.font="bold 24px Arial",l.textAlign="left";let s,r,o=(t=a,s=0,r=0,t.forEach(e=>{"sim"===e.answers.q1&&s++,"sim"===e.answers.q2&&r++}),{victims:s,witnesses:r,victimPercentage:Math.round(s/t.length*100),witnessPercentage:Math.round(r/t.length*100)});l.fillText(`Total de Entrevistas: ${a.length}`,50,i),i+=40,l.fillText(`Sofreram Bullying: ${o.victims} (${o.victimPercentage}%)`,50,i),i+=40,l.fillText(`Presenciaram Bullying: ${o.witnesses} (${o.witnessPercentage}%)`,50,i),function e(t,a,n,l){let i=a+150,s=n+150;l.victims,l.witnesses,l.victims,l.witnessPercentage;let r=-Math.PI/2;t.fillStyle="#ff6b6b",t.beginPath(),t.moveTo(i,s);let o=l.victims/100*2*Math.PI;t.arc(i,s,100,r,r+o),t.closePath(),t.fill(),r+=o,t.fillStyle="#4facfe",t.beginPath(),t.moveTo(i,s);let d=(l.witnesses-l.victims)/100*2*Math.PI;t.arc(i,s,100,r,r+d),t.closePath(),t.fill(),r+=d,t.fillStyle="#a1c4fd",t.beginPath(),t.moveTo(i,s),t.arc(i,s,100,r,r+(2*Math.PI-o-d)),t.closePath(),t.fill(),t.font="16px Arial",t.fillStyle="#333333",t.fillText("\uD83D\uDD34 Sofreram Bullying",a+320,n+50),t.fillText("\uD83D\uDD35 Apenas Presenciaram",a+320,n+80),t.fillText("\uD83D\uDFE3 N\xe3o Envolvidos",a+320,n+110)}(l,50,i+=60,o);let d=n.toDataURL("image/jpeg",.8),c=document.createElement("a");c.download=`relatorio-completo-bullying-${new Date().toISOString().split("T")[0]}.jpg`,c.href=d,c.click()})()}),document.getElementById("interview-date").valueAsDate=new Date,document.querySelectorAll(".feature-card").forEach((e,t)=>{e.style.animationDelay=`${.2*t}s`}),c(),g()});